<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>AgriTech - Upload</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=grass">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Ubuntu", sans-serif;
            margin: 0;
            background: linear-gradient(to bottom, #e8f5e9, #ffffff);
            color: #2f8206;
        }

        .header {
            background-color: #2f8206b8;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .redirect-item {
            color: white;
            text-decoration: none;
            font-weight: 500;
            margin-left: 1rem;
            transition: color 0.3s ease;
        }

        .redirect-item:hover {
            color: #c6ff00;
        }

        .material-symbols-outlined {
            color: white;
            font-variation-settings: 'FILL' 0, 'wght' 800, 'GRAD' 0, 'opsz' 24;
            font-size: 40px;
        }

        .content {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 3rem 1rem;
            flex-direction: column;
        }

        .uploads {
            background-color: #ffffffcc;
            border-radius: 15px;
            padding: 3rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
        }

        .upload-heading {
            font-size: 2.5rem;
            font-weight: 500;
            margin-bottom: 2rem;
            text-align: center;
        }

        .form-control {
            border-radius: 10px;
        }

        .btn-success {
            width: 100%;
            padding: 0.8rem;
            font-size: 1.1rem;
            border-radius: 50px;
            background-color: #2f8206;
            border: none;
            transition: 0.3s;
        }

        .btn-success:hover {
            background-color: #65c466;
        }

        /* Result Box Style */
        .prediction {
            margin-top: 2rem;
            background-color: #f1f8e9;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 5px solid #2f8206;
        }

        /* Error Box Style */
        .error-box {
            margin-top: 2rem;
            background-color: #fff5f5;
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid #feb2b2;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .error-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            margin-left: 15px;
        }

        /* Loading Spinner */
        #loading {
            display: none;
            text-align: center;
            margin-top: 1rem;
        }
    </style>
</head>
<body>

<header class="header">
    <div>
        <span class="material-symbols-outlined">grass</span>
    </div>
    <nav>
        <a th:href="@{/}" class="redirect-item">Home</a>
        <a th:href="@{/upload}" class="redirect-item">Upload</a>
        <a th:href="@{/home}" class="redirect-item">Profile</a>
    </nav>
</header>

<div class="content">
    <div class="uploads">
        <h1 class="upload-heading">Upload to Detect Disease</h1>
        
        <form th:action="@{/predict}" method="post" enctype="multipart/form-data" onsubmit="showLoading()">
            <input class="form-control mb-3" type="file" name="file" id="fileInput" required />
            <button type="submit" class="btn btn-success">Analyze Leaf</button>
        </form>

        <div id="loading">
            <div class="spinner-border text-success" role="status"></div>
            <p class="mt-2 text-muted small">Waking up AI... This may take a minute on the first try.</p>
        </div>

        <div class="prediction" th:if="${result}">
            <h4>Prediction Results</h4>
            <p><strong>Status:</strong> <span th:text="${result.status}"></span></p>
            <p><strong>Disease:</strong> <span th:text="${result.disease}"></span></p>
            <p><strong>Confidence:</strong> <span th:text="${#numbers.formatPercent(result.confidence, 1, 2)}"></span></p>
        </div>

        <div class="error-box" th:if="${error}">
            <div>
                <h5 class="text-danger">Detection Failed</h5>
                <p class="text-muted small mb-0" th:text="${error}"></p>
                <a href="/upload" class="btn btn-link btn-sm p-0 text-danger">Try another photo</a>
            </div>
            <img src="https://res.cloudinary.com/drpsxdn8u/image/upload/v1766565011/439605032_1203590010628368_6519436146906537304_n_kocepm.jpg" 
                 alt="Error" class="error-image">
        </div>
    </div>
</div>

<script>
    function showLoading() {
        document.getElementById('loading').style.display = 'block';
    }
</script>

</body>
</html>